'use strict';
$(document).ready(function(){

    var findBootstrapEnvironment = function() {
        var envs = ['xs', 'sm', 'md', 'lg'];

        var el = $('<div>');
        el.appendTo($('body'));

        for (var i = envs.length - 1; i >= 0; i--) {
            var env = envs[i];

            el.addClass('hidden-'+env);
            if (el.is(':hidden')) {
                el.remove();
                return env
            }
        };
    }

    var env;
    var panels = function(){
      var ho = 0;
      var h = $(window).height() - ho;
      env = findBootstrapEnvironment();
      
      $('#side-col, #content-col').css({
          'height': h+'px',
          'top': ho+'px'
      });

      $('.ps-scroller')
          .perfectScrollbar();

    }



    panels();
    $(window).resize(function(){
        panels();
    });

     // Start as collapsed for small devices
    if(env === 'xs' || env === 'sm'){
        $("#side-col").toggleClass('do-collapse');
    }

    $('a.collapser').click(function(e){
        e.preventDefault();
        e.stopPropagation();
        $("#side-col").toggleClass('do-collapse');
        if($("#side-col").hasClass('do-collapse')){
            $("#side-col").width('40px');
            $("#content-col").innerWidth(($(window).width()-41)+'px');
            if(env === 'xs' || env === 'sm'){
                $("#side-col").css('z-index', '1');
                //$("#content-col").css('left', '');
            }
            //console.info($("#content-col").width(), $(window).width()-41);
        } else {
            $("#side-col").width('');
            $("#content-col").width('');
            if(env === 'xs' || env === 'sm'){
                $("#side-col").css('z-index', '3');
                //$("#content-col").css('left', '260px');
            }
        }
    });
});

/**
 * @ngdoc overview
 * @name anyandgoApp
 * @description
 * # anyandgoApp
 *
 * Main module of the application.
 */
angular
  .module('anyandgoApp', [
    'toastr',
    'ngAnimate',
    'ngCookies',
    'ngResource',
    'ngRoute',
    'ngSanitize',
    'ngTouch',
    'toggle-switch',
    'adf',
    'adf.structures.base',
    'adf.widget.clock',
    'adf.widget.weather',
    'cfp.hotkeys',
    'restangular'
  ])
  .config(function ($routeProvider, $locationProvider, RestangularProvider, hotkeysProvider, toastrConfig) {

    // Hotkeys killswitch
    // see https://github.com/chieffancypants/angular-hotkeys#configuration
    hotkeysProvider.includeCheatSheet = true;

    //$locationProvider.html5Mode(true).hashPrefix('!');
    $routeProvider
      .when('/', {
        templateUrl: '/scripts/admin/views/main.html',
        controller: 'MainCtrl'
      })
      .when('/crud/sample', {
        templateUrl: '/scripts/admin/views/sample.html',
        controller: 'SampleCtrl'
      })
      .when('/crud/sample-new', {
        templateUrl: '/forms/sample/create',
        controller: 'SampleNewCtrl'
      })
      .when('/crud/sample-edit/:id', {
        templateUrl: '/forms/sample/create',
        controller: 'SampleEditCtrl',
        resolve: {
          sample: function(Restangular, $route){
            return Restangular.one('samples', $route.current.params.id).get();
          }
        }
      })
      .when('/crud/user', {
        templateUrl: '/scripts/admin/views/user.html',
        controller: 'UserCtrl'
      })
      .when('/crud/user-new', {
        templateUrl: '/forms/user/create',
        controller: 'UserNewCtrl'
      })
      .when('/crud/user-edit/:id', {
        templateUrl: '/forms/user/create',
        controller: 'UserEditCtrl',
        resolve: {
          user: function(Restangular, $route){
            return Restangular.one('users', $route.current.params.id).get();
          }
        }
      })
      .when('/crud/pedido', {
        templateUrl: '/scripts/admin/views/pedido.html',
        controller: 'PedidoCtrl'
      })
      .when('/crud/pedido-new', {
        templateUrl: '/forms/pedido/create',
        controller: 'PedidoNewCtrl'
      })
      .when('/crud/pedido-edit/:id', {
        templateUrl: '/forms/pedido/create',
        controller: 'PedidoEditCtrl',
        resolve: {
          pedido: function(Restangular, $route){
            return Restangular.one('pedidos', $route.current.params.id).get();
          }
        }
      })
      .otherwise({


        redirectTo: '/'
      });
      
      RestangularProvider.setBaseUrl('/api/v1');
      RestangularProvider.setRestangularFields({
        id: '_id'
      });
      
      RestangularProvider.setRequestInterceptor(function(elem, operation, what) {
        
        if (operation === 'put') {
          elem._id = undefined;
          return elem;
        }
        return elem;
      });

      angular.extend(toastrConfig, {
        autoDismiss: false,
        containerId: 'toast-container',
        maxOpened: 0,    
        newestOnTop: true,
        positionClass: 'toast-bottom-right',
        preventDuplicates: false,
        preventOpenDuplicates: false,
        target: 'body'
      });

  }).run(function ($rootScope, $location, $route, $timeout, $http, $cookies) {

    /*
    */

    $rootScope.config = {};
    $rootScope.config.app_url = $location.url();
    $rootScope.config.app_path = $location.path();
    $rootScope.layout = {};
    $rootScope.layout.loading = false;

    if(!navigator.userAgent.match(/Zombie/)) {

    $rootScope.$on('$routeChangeStart', function () {
        console.log('$routeChangeStart');
        //show loading gif
        $timeout(function(){
          $rootScope.layout.loading = true;          
        });
    });
    $rootScope.$on('$routeChangeSuccess', function () {
        console.log('$routeChangeSuccess');
        //hide loading gif
        $timeout(function(){
          $rootScope.layout.loading = false;
        }, 200);
    });
    $rootScope.$on('$routeChangeError', function () {

        //hide loading gif
        console.log('error');
        $rootScope.layout.loading = false;

    });

    }

  });


'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:MainCtrl
 * @description
 * # MainCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('MainCtrl', function ($scope, $timeout, toastr) {
    $scope.anyandgoversion = 'v1.0';
    toastr.info('Welcome to anyandgo v1.0', 'Information');
    var model = false;
    if (!model) {
      // set default model for demo purposes
      model = {
        title: "Dashboard",
        structure: "4-8",
        rows: [{
          columns: [{
            styleClass: "col-md-4",
            widgets: [{
              type: "weather",
              config: {
                location: "Rosario"
              },
              title: "Weather Rosario"
            }, {
              type: "weather",
              config: {
                location: "San Francisco"
              },
              title: "Weather San Francisco"
            }]
          }, {
            styleClass: "col-md-8",
            widgets: [{
              type: "clock",
              config: {
                timePattern: 'HH:mm:ss',
                datePattern: 'YYYY-MM-DD'
              },
              title: "Clock"
            }]
          }]
        }]
      };
    }
    $scope.model = model;
  });

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:AboutCtrl
 * @description
 * # AboutCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('AboutCtrl', function ($scope) {
    $scope.awesomeThings = [
      'HTML5 Boilerplate',
      'AngularJS',
      'Karma'
    ];
  });

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:SampleCtrl
 * @description
 * # SampleCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('SampleCtrl', function ($scope, Restangular) {
   $scope.samples = Restangular.all("samples").getList().$object;
  });

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:SampleNewCtrl
 * @description
 * # SampleNewCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('SampleNewCtrl', function ($scope, $location, Restangular) {
  $scope.save = function() {
    Restangular.all('samples').post($scope.sample).then(function(sample) {  
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/sample";
      } else {
        $location.path('/crud/sample');
      }
    });
  }
});

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:SampleEditCtrl
 * @description
 * # SampleEditCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('SampleEditCtrl', function ($scope, $location, Restangular, toastr, sample) {
  var original = sample;
  $scope.sample = Restangular.copy(original);
  

  $scope.isClean = function() {
    return angular.equals(original, $scope.sample);
  }

  $scope.destroy = function() {
    original.remove().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/sample";
      } else {
        $location.path('/crud/sample');
      }
    });
  };

  $scope.save = function() {
    $scope.sample.put().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/sample";
      } else {
        toastr.success('Document was saved', 'Success');
        $location.path('/crud/sample');
      }
    });
  };
});

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:UserCtrl
 * @description
 * # UserCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('UserCtrl', function ($scope, Restangular) {
   $scope.users = Restangular.all("users").getList().$object;
  });

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:UserNewCtrl
 * @description
 * # UserNewCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('UserNewCtrl', function ($scope, $location, Restangular) {
  $scope.save = function() {
    Restangular.all('users').post($scope.user).then(function(user) {  
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/user";
      } else {
        $location.path('/crud/user');
      }
    });
  }
});

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:UserEditCtrl
 * @description
 * # UserEditCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('UserEditCtrl', function ($scope, $location, Restangular, user) {
  var original = user;
  $scope.user = Restangular.copy(original);
  

  $scope.isClean = function() {
    return angular.equals(original, $scope.user);
  }

  $scope.destroy = function() {
    original.remove().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/user";
      } else {
        $location.path('/crud/user');
      }
    });
  };

  $scope.save = function() {
    $scope.user.put().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/user";
      } else {
        $location.path('/crud/user');
      }
    });
  };
});

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:PedidoCtrl
 * @description
 * # PedidoCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('PedidoCtrl', function ($scope, Restangular) {
   $scope.pedidos = Restangular.all("pedidos").getList().$object;
  });

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:PedidoNewCtrl
 * @description
 * # PedidoNewCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('PedidoNewCtrl', function ($scope, $location, Restangular) {
  $scope.save = function() {
    Restangular.all('pedidos').post($scope.pedido).then(function(pedido) {  
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/pedido";
      } else {
        $location.path('/crud/pedido');
      }
    });
  }
});

'use strict';

/**
 * @ngdoc function
 * @name anyandgoApp.controller:PedidoEditCtrl
 * @description
 * # PedidoEditCtrl
 * Controller of the anyandgoApp
 */
angular.module('anyandgoApp')
  .controller('PedidoEditCtrl', function ($scope, $location, Restangular, pedido) {
  var original = pedido;
  $scope.pedido = Restangular.copy(original);
  

  $scope.isClean = function() {
    return angular.equals(original, $scope.pedido);
  }

  $scope.destroy = function() {
    original.remove().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/pedido";
      } else {
        $location.path('/crud/pedido');
      }
    });
  };

  $scope.save = function() {
    $scope.pedido.put().then(function() {
      if(navigator.userAgent.match(/Zombie/)) {
          document.location.hash = "#/crud/pedido";
      } else {
        $location.path('/crud/pedido');
      }
    });
  };
});

'use strict';

/**
 * @ngdoc directive
 * @name anyandgoApp.directive:metismenu
 * @description
 * # metismenu
 */
angular.module('anyandgoApp')
  .directive('metismenu', function () {
    return {
      restrict: 'A',
      link: function postLink(scope, element, attrs) {
        $(element).metisMenu(scope.$eval(attrs.toolbarTip));
      }
    };
  });

'use strict';

/**
 * @ngdoc directive
 * @name anyandgoApp.directive:loadingmessage
 * @description
 * # loading
 */
angular.module('anyandgoApp')
  .directive('loadingmessage', function ($timeout) {
    return {
      restrict: 'A',
      link: function postLink(scope, element, attrs) {
        $(window).load(function() {
          //element.find('.preloading-message').addClass('animated bounceOutUp');
          $('.collapser').click();
          $timeout(function(){
            element.addClass('animated flipOutX');
            //element.hide();
          }, 2000)
        });
      }
    };
  });
